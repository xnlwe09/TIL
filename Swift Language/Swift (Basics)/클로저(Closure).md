# í´ë¡œì €(Closure)

## í´ë¡œì €(Closure)ë€?

**ì£¼ë³€ ë¬¸ë§¥ìœ¼ë¡œë¶€í„° ê°’ì„ ìº¡ì²˜í•  ìˆ˜ ìˆëŠ” ì½”ë“œ ë¸”ë¡**

í´ë¡œì €(Closure)ì—” Named Closureì™€ Unnamed Closureê°€ ìˆëŠ”ë°

Named ClosureëŠ” í”íˆ ìš°ë¦¬ê°€ ì‚¬ìš©í•˜ëŠ” ì´ë¦„ìˆëŠ” í•¨ìˆ˜ (ì´ê²ƒë„ í´ë¡œì €ì§€ë§Œ í´ë¡œì €ë¼ê³  ì•ˆë¶€ë¥¼ ë¿ì„)

Unnamed ClosureëŠ” ì´ë¦„ì„ ë¶™ì´ì§€ ì•Šê³  ì‚¬ìš©í•˜ëŠ” (func í‚¤ì›Œë“œë„ ì—†ì´)

```swift
let closure = { print("Juhui") }
```

ì´ëŸ° í˜•íƒœì˜ ìµëª…í•¨ìˆ˜

**â‡’ ë³´í†µ í´ë¡œì €(Closure)ë¼ê³  í•˜ë©´ ìœ„ ê°™ì€ ìµëª…í•¨ìˆ˜(Unnamed Closure)ë¥¼ ë§í•¨**

- í•¨ìˆ˜ : ì´ë¦„ì´ ìˆê³  func í‚¤ì›Œë“œë¡œ ì •ì˜
- í´ë¡œì € : ì´ë¦„ì´ ì—†ì–´ë„ ë˜ê³ , ë³€ìˆ˜ë‚˜ ìƒìˆ˜ì— ë‹´ì•„ì„œ ì‚¬ìš© ê°€ëŠ¥

â‡’ í´ë¡œì €ëŠ” í•¨ìˆ˜ì˜ ì¸ìë¡œë„ ìì£¼ ì‚¬ìš©ë¨

## í´ë¡œì € í‘œí˜„ì‹ (ê¸°ë³¸ êµ¬ì¡°)

```swift
{ (ë§¤ê°œë³€ìˆ˜) -> ë°˜í™˜íƒ€ì… in // inì„ ê¸°ì¤€ìœ¼ë¡œ ì•ì€ Closure Head
    ì‹¤í–‰í•  ì½”ë“œ // ë’¤ëŠ” Closure Body
}
```

### ex) ë‘ ì •ìˆ˜ë¥¼ ë°›ì•„ í•©ì„ ë°˜í™˜í•˜ëŠ” í´ë¡œì €(Closure)

```swift
let sumClosure: (Int, Int) -> Int = { (a, b) in
    return a + b
}

let result = sumClosure(3, 5) // result = 8
```

## í´ë¡œì €(Closure) ë¬¸ë²• ì¶•ì•½

<aside>

### ğŸ“return ìƒëµ

ë‹¨ì¼ í‘œí˜„ì‹ì¼ ê²½ìš° return ìƒëµ ê°€ëŠ¥

```swift
let sumClosure: (Int, Int) -> Int = { (a: Int, b: Int) in a + b }
```

</aside>

<aside>

### ğŸ“íŒŒë¼ë¯¸í„° íƒ€ì… ìƒëµ

ì´ë¯¸ ì™¼ìª½ì—ì„œ (Int, Int) -> Int íƒ€ì…ì„ ì§€ì •í–ˆìœ¼ë‹ˆ a, b íƒ€ì… í‘œì‹œëŠ” ìƒëµí•´ë„ ë¨

```swift
let sumClosure: (Int, Int) -> Int = { (a, b) in a + b }
```

</aside>

<aside>

### ğŸ“íŒŒë¼ë¯¸í„° ì´ë¦„ ìƒëµ

í´ë¡œì € ì•ˆì—ì„œ ì²« ë²ˆì§¸ ì¸ìëŠ” $0, ë‘ ë²ˆì§¸ ì¸ìëŠ” $1ë¡œ ìë™ ì ‘ê·¼ ê°€ëŠ¥

```swift
let sumClosure: (Int, Int) -> Int = { $0 + $1 }
```

</aside>

### ìµœì¢…ì¶•ì•½

```swift
let sumClosure: (Int, Int) -> Int = { $0 + $1 }
let result = sumClosure(3, 5) // 8
```

+ íŒŒë¼ë¯¸í„°ê°€ í•˜ë‚˜ì¸ ê²½ìš° ()ë„ ìƒëµ ê°€ëŠ¥ = ()ì— ê°’ì´ ì•„ë¬´ê²ƒë„ ì—†ë‹¤ë©´ ìƒëµ

## **íŠ¸ë ˆì¼ë§ í´ë¡œì €(Trailing Closure)**

<aside>

í•¨ìˆ˜ì˜ ë§ˆì§€ë§‰ íŒŒë¼ë¯¸í„°ê°€ í´ë¡œì €ì¼ ë•Œ,

ì´ë¥¼ íŒŒë¼ë¯¸í„° ê°’ í˜•ì‹ì´ ì•„ë‹Œ í•¨ìˆ˜ ë’¤ì— ë¶™ì—¬ ì‘ì„±í•˜ëŠ” ë¬¸ë²•

ì´ë•Œ, Argument Labelì€ ìƒëµëœë‹¤

```swift
// ì›ë˜ í˜•ì‹
doSomething(closure: { () -> () in
    print("Hello!")
}) // í˜¸ì¶œ êµ¬ë¬¸ () ì•ˆì— í´ë¡œì €ê°€ ìˆìŒ = Inline Closure

// Trailing Closure
doSomething () **{ () -> () in
    print("Hello!")
}** // ëì— í´ë¡œì €ê°€ ìˆìŒ
```

íŒŒë¼ë¯¸í„°ê°€ í´ë¡œì € í•˜ë‚˜ì¼ ê²½ìš°ì—” í˜¸ì¶œêµ¬ë¬¸ì¸Â ()ë„ ìƒëµ ê°€ëŠ¥

```swift
doSomething { () -> () in
    print("Hello!")
}
```

</aside>

## ìº¡ì³(Capture)

<aside>

í´ë¡œì €ëŠ” ì™¸ë¶€ ë³€ìˆ˜ë¥¼ ê¸°ì–µí•˜ê³  ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

```swift
func doSomething() {
    var message = "ì£¼í¬ is iOS Developer"
 
    //í´ë¡œì € ë²”ìœ„ ì‹œì‘
    
    var num = 10
    let closure = { print(num) }
 
    //í´ë¡œì € ë²”ìœ„ ë
    
    print(message)
}

```

í´ë¡œì €(Closure)ì—ì„œ numì´ë¼ëŠ” ì™¸ë¶€ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—

numì˜ ê°’ì„ í´ë¡œì € ë‚´ë¶€ì ìœ¼ë¡œ ì €ì¥í•˜ê³  ìˆìŒ

â†’ í´ë¡œì €ì— ì˜í•´ numì˜ ê°’ì´ **ìº¡ì³(Capture)** ë˜ì—ˆë‹¤ê³  í•¨

</aside>

<aside>

### ğŸ“Reference Capture

í´ë¡œì €(Closure)ëŠ” Value/Reference íƒ€ì…ì— ê´€ê³„ ì—†ì´ Reference Capture

(ê°’ íƒ€ì…ì„ ì €ì¥í•˜ë ¤ë©´ ê°’ì„ ë³µì‚¬í•´ì„œ ì „ë‹¬í•´ì•¼ë í…ë° í´ë¡œì €ëŠ” ê·¸ë ‡ì§€ ì•Šê³ 

íƒ€ì…ì— ê´€ê³„ì—†ì´ ìº¡ì³í•˜ëŠ” ê°’ë“¤ì„ ì°¸ì¡°í•¨)

â‡’ ê·¸ë˜ì„œ í´ë¡œì € ì™¸ë¶€ì—ì„œ ê°’ì´ ë°”ë€Œë©´ í´ë¡œì € ë‚´ë¶€ ê°’ë„ ë°”ë€Œê³ 

ë°˜ëŒ€ë¡œ í´ë¡œì € ë‚´ë¶€ì—ì„œ ê°’ì´ ë°”ë€Œì–´ë„ í´ë¡œì € ì™¸ë¶€ì— ìˆëŠ” ê°’ë„ ë°”ë€œ!

```swift
func doSomething() {
    var num: Int = 0
    print("num #1 = \(num)")
    
    let closure = {
        num = 20
        print("num #3 = \(num)")
    }
    
    closure()
    print("num #2 = \(num)")
}
 
```

</aside>

<aside>

### ğŸ“í´ë¡œì €ì˜ ìº¡ì³ ë¦¬ìŠ¤íŠ¸(Capture Lists)

Value Typeìœ¼ë¡œ ìº¡ì³í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•

**í´**ë¡œì €ì˜ ì‹œì‘ì¸ { ì˜ ë°”ë¡œ ì˜†ì—Â Â []ë¥¼ ì´ìš©í•´ ìº¡ì³í•  ë©¤ë²„ë¥¼ ë‚˜ì—´ (ì´ë•Œ in í‚¤ì›Œë“œë„ ê¼­ í•¨ê»˜ ì‘ì„±)

```swift
let closure { [num, num2] in
```

Value Typeì˜ ê²½ìš°, Value Capture í•˜ê³  ì‹¶ì€ ë³€ìˆ˜ë¥¼ ìœ„ ê°™ì´ ë¦¬ìŠ¤íŠ¸ë¡œ ëª…ì‹œ

```swift
func doSomething() {
    var num: Int = 0
    print("num check #1 = \(num)")
    
    let closure = { [num] in
        print("num check #3 = \(num)")
    }
    
    num = 20
    print("num check #2 = \(num)")
    closure()
}
```

ê·¼ë° ì´ê±´ ìƒìˆ˜ë¡œ ìº¡ì³ë¼ì„œ í´ë¡œì € ë‚´ë¶€ì—ì„œ ê°’ì„ ëª» ë°”ê¿ˆ

</aside>

## weak self

**í´ë¡œì €ê°€ selfë¥¼ ì•½í•˜ê²Œ ìº¡ì³í•˜ê²Œ í•´ì„œ ìˆœí™˜ ì°¸ì¡°ë¥¼ ë°©ì§€í•˜ëŠ” ë°©ë²•**

<aside>

- í´ë¡œì € ë‚´ë¶€ì—ì„œ selfë¥¼ ì‚¬ìš©í•˜ë©´ í´ë¡œì €ê°€ selfë¥¼ ê°•í•˜ê²Œ ìº¡ì³í•˜ê²Œ ë¨
- ê·¼ë° selfë„ ê·¸ í´ë¡œì €ë¥¼ ê°•í•˜ê²Œ ì°¸ì¡°í•˜ê³  ìˆìœ¼ë©´ ìˆœí™˜ ì°¸ì¡° ë°œìƒ
- ì´ë•Œ `weak self`ë¥¼ ì‚¬ìš©í•˜ë©´ í´ë¡œì €ê°€ selfë¥¼ ì•½í•˜ê²Œ ìº¡ì³í•¨
- ê·¸ë˜ì„œ ì°¸ì¡° ì¹´ìš´íŠ¸ê°€ ì¦ê°€í•˜ì§€ ì•Šì•„ì„œ ìˆœí™˜ ì°¸ì¡°ë„ ì•ˆ ìƒê¹€!!

- ìµœì¢…ì ìœ¼ë¡œ í´ë¡œì €ê°€ ì¡´ì¬í•˜ë”ë¼ë„ selfê°€ ë‹¤ë¥¸ ê³³ì—ì„œ ë” ì´ìƒ í•„ìš” ì—†ìœ¼ë©´ ARCê°€ í•´ì œí•  ìˆ˜ ìˆê²Œ ë¨
- self í•´ì²´ â†’ í´ë¡œì € ë‚´ë¶€ì—ì„œì˜ selfëŠ” ìë™ìœ¼ë¡œ nil
</aside>

ê·¸ë‹ˆê¹Œ weak selfë¥¼ ì“°ë©´ í•œ ê°ì²´ê°€ ì°¸ì¡° ì¹´ìš´íŠ¸ì— í¬í•¨ì•ˆë˜ê²Œ í•´ì„œ í•„ìš”ì—†ì„ ë• í•´ì œí•  ìˆ˜ ìˆë‹¤ëŠ” ê±°ì„ìš©

```swift
// í´ë¡œì € ê¸°ë³¸ êµ¬ì¡°
{ (ë§¤ê°œë³€ìˆ˜) -> ë°˜í™˜íƒ€ì… in // inì„ ê¸°ì¤€ìœ¼ë¡œ ì•ì€ Closure Head
    ì‹¤í–‰í•  ì½”ë“œ // ë’¤ëŠ” Closure Body
}
```

```swift
{ [weak self] (ë§¤ê°œë³€ìˆ˜) -> ë°˜í™˜íƒ€ì… in
    // ì‹¤í–‰í•  ì½”ë“œ
}
```

```swift
someFunction { [weak self] in
    // weak selfë¡œ ìº¡ì²˜
    self?.doSomething()  // selfëŠ” ë‹¤ë¥¸ ì°¸ì¡°ê°€ ì‚¬ë¼ì§€ë©´ nilì´ ë  ìˆ˜ ìˆìœ¼ë‹ˆê¹Œ ì˜µì…”ë„ì¸ ê±°ì„
}
```

```swift
someAsyncFunction { [weak self] result in
    guard let self = self else { return }  // selfë¥¼ ì•ˆì „í•˜ê²Œ ì–¸ë˜í•‘
    
    // ì´ì œ selfë¥¼ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥
    processResult(result)
    updateUI()
    saveData()
}
```
